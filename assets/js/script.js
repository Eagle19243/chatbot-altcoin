var BaseURL="https://api.dialogflow.com/v1/query?v=20170712&",AccessToken="5d8696da838744a7a30ee2912c790c38";function getSession(){var e=null;if(sessionStorage.getItem("session"))e=sessionStorage.getItem("session");else{var t=Math.floor(1e3*Math.random()+1),s=Date.now(),n=new Date,o=new Array(7);o[0]="Sunday",o[1]="Monday",o[2]="Tuesday",o[3]="Wednesday",o[4]="Thursday",o[5]="Friday",o[6]="Saturday";var a=t+o[n.getDay()]+s;sessionStorage.setItem("session",a),e=sessionStorage.getItem("session")}return e}function sendRequest(e){var t=getSession();$.ajax({type:"GET",url:BaseURL+"query="+e+"&lang=en&sessionId="+t,contentType:"application/json",dataType:"json",headers:{Authorization:"Bearer "+AccessToken},success:function(e){processResponse(e)}})}function processResponse(e){e.result.action;e.result.fulfillment.messages&&0!=e.result.fulfillment.messages.length&&(e.result.fulfillment.messages[0].payload?setBotResponse(e.result.fulfillment.messages[0].payload.body):setBotResponse([{type:"text",value:"Sorry, I couldn't get that. Please ask any other question."}]))}function setBotResponse(e){if(0!=e.length){var t='<div class="server-response">';e.forEach(function(e){"text"==e.type?t+=getTextContent(e.value):"button"==e.type?t+=getButtonContent(e.value):"link"==e.type&&(t+=getLinkContent(e.value))}),t+="</div>",$("#result").append(t),scrollToBottomOfResult()}}function getTextContent(e){return'<div class="msg-text">'+e+"</div>"}function getButtonContent(e){return'<span class="msg-btn">'+e+"</span>"}function getLinkContent(e){return'<a href="'+e+'" class="msg-link" target="_blank">'+e+"</a>"}function setUserResponse(e){var t='<div class="user-request">'+e+"</div>";$("#result").append(t)}function scrollToBottomOfResult(){var e=document.getElementById("result");$("#resultWrapper").scrollTop(e.scrollHeight)}$(document).ready(function(){$("#query").on("keyup keypress",function(e){var t=e.keyCode||e.which,s=$(this).val();if(13===t)return""==s||""==$.trim(s)?(e.preventDefault(),!1):(setUserResponse(s),sendRequest(s),scrollToBottomOfResult(),$(this).val(""),e.preventDefault(),!1)}),$(document).on("click",".msg-btn",function(){var e=$(this).text();setUserResponse(e),sendRequest(e),scrollToBottomOfResult()})});